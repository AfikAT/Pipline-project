#!groovy
pipeline {
    environment {
        REGISTRY = "afik/argocd-project"
        REGESTRY_CRED = 'Docker_hub'
        BUILD_NUMBER = "${env.BUILD_ID}"
        DOCKER_LOGIN = "${USERNAME}"
        DOCKER_PASS = "${PASSWORD}"
    }
    agent any
    stages {
         stage('pushing_image') {
             steps {
                 dir('import') {
                    script {
                            echo 'Building Dockerfile'
                            withCredentials([usernamePassword(credentialsId: 'Docker_hub', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                                sh 'docker login ${DOCKER_LOGIN} -p ${DOCKER_PASS}'
                                sh './push_docker_image.sh ${BUILD_NUMBER} ${REGISTRY}'
                            }
                    }
                 }
             }
         }
    }
}
                    
